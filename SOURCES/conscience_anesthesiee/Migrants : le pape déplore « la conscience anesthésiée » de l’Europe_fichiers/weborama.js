define(function(require){var $=require("jquery");var objectPath=require("lib/object-path");var conf=require("lmd/core/conf");var context=require("lmd/core/context");var storage=require("lmd/core/storage");function injectIframe(url){var $container=$("body");var $iframe=$("<iframe>",{src:url,width:0,height:0,frameborder:0}).hide();$container.append($iframe)}function injectWeboramaScript(){var configuration=getConfiguration();window.wamid="2446";window.typ="1";window.Wvar=[];$.each(configuration,function(index,
value){window.Wvar.push(index,value)});var script=document.createElement("script");script.src=("https:"===document.location.protocol?"https://":"http://")+"cstatic.weborama.fr/js/wam/customers/wamfactory_dpm.lemonde.min.js";document.body.appendChild(script)}function injectConversionTag(callback){var wct=document.createElement("script");wct.type="text/javascript";wct.onload=callback||function(){};wct.src="http://cstatic.weborama.fr/js/advertiserv2/adperf_conversion.js";var s=document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(wct,s)}function addConversionTag(siteId,conversionPageId){var trackAction=function(){try{adperfTracker.track({fullhost:"groupelemonde.solution.weborama.fr",site:siteId,conversion_page:conversionPageId})}catch(error){}};if(typeof adperfTracker==="undefined")injectConversionTag(trackAction);else trackAction()}function getConfiguration(){var configuration={site:"Lemonde",cat1:objectPath.get(context,"rubrique.url_friendly")||"",contenu:context.pageType||"",motclef:"",device:getCurrentDevice(),
id_crm:objectPath.get(storage.get("lmd_crm_data",false),"browserId")||0,user_id:objectPath.get(storage.get("user",false),"id")||0,user_statut:lmd.auth_sync.abonne?"abonne":"anonyme",user_gender:"",user_age:"",user_postalcode:""};addConfigurationCategories(configuration);return configuration}function addConfigurationCategories(configuration){var categories=Array.prototype.slice.call(lmd.context.rubriques||lmd.context.rubrique||[]);var categoryIndex=1;$.each(categories,function(index,category){if(category.url_friendly!==
configuration.cat1){var varName="cat"+ ++categoryIndex;configuration[varName]=category.url_friendly}})}function getCurrentDevice(){var breakpoints={mobile:320,tablet:768,desktop:1E3};var breakpoint=false;for(var key in breakpoints)if(breakpoints[key]<document.documentElement.clientWidth)breakpoint=key;return breakpoint}if(conf.fsw.weborama)(function(lmd){lmd.onload(function(){injectIframe("//cstatic.weborama.fr/iframe/customers/premium.html?idEditeur=1173&idSite=257");injectWeboramaScript()})})(window.lmd);
return{addConversionTag:addConversionTag}});
