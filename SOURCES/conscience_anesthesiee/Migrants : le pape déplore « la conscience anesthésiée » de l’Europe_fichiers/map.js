define(["jquery.fallback","lib/d3/core/3.4.1/d3","lib/d3/plugin/topojson","jquery-ui/tooltip","jquery-ui/widget","jquery-ui/mouse","jquery-ui/position"],function($,d3,topojson,tooltip,widget,mouse,position){function init(){var url_base="http://"+lmd.conf.www.location.hostname+"/";var height=280,width=312,pays_page=[];var projection=d3.geo.mercator().center([65,37]).rotate([0,0,-2]).scale(360);var path=d3.geo.path().projection(projection);var svg=d3.select(".carte").append("svg").attr("width",width).attr("height",
height);var mer=svg.append("g").attr("id","mer").append("rect").attr("width",width).attr("height",height).attr("class","mer");var europe=svg.append("g").attr("id","terre").attr("width",width).attr("height",height);$(document).tooltip({track:true,items:".ue",content:function(){var element=$(this);if(element.is(".ue"))return element.attr("title")},hide:150,position:{my:"center top-55",at:"top center",collision:"none",using:function(position,feedback){$(this).css(position);$("<div>").addClass("arrow").addClass(feedback.vertical).addClass(feedback.horizontal).appendTo(this)}}});
d3.json("/medias/web/js/data/map/europeennes/europe.json",function(eu){europe.selectAll("path").data(topojson.feature(eu,eu.objects.layer1).features).enter().append("a").attr("xlink:href",function(d){return url_base+d.properties.url+"/"}).append("path").attr("d",path).attr("id",function(d){if(d.properties.CNTR_ID=="MT"){var centroid=path.centroid(d);europe.append("a").attr("xlink:href",function(d){return url_base+"malte"+"/"}).append("circle").attr("class","ue").attr("id","cercle_mt").attr("cx",centroid[0]).attr("cy",
centroid[1]).attr("r",3).attr("fill-opacity",0).attr("stroke","#c7dfea").attr("stroke-width",2).attr("title","<span class='tt5_capital' style='color:#0574C5'>"+"Malte"+"</span>").on("mouseover",overMalte).on("mouseout",outMalte).on("click",clickMalte)}return d.properties.CNTR_ID}).attr("fill",function(d,i){var tab=document.URL.split("/");tab.pop();pays_page=tab[tab.length-1];var couleur="none";if(d.properties.url==pays_page)couleur="#0574C5";else if(d.properties.europe_UE=="O")couleur="#c7dfea";else couleur=
"#f5f8f9";if(pays_page=="malte")d3.select("#cercle_mt").attr("stroke","#0574C5");return couleur}).attr("class",function(d){var ue=d.properties.europe_UE=="O"?"ue":"nonue";return ue}).attr("stroke","#FFF").attr("stroke-width",1).attr("title",function(d){var texte=d.properties.europe_UE=="O"?"<span class='tt5_capital' style='color:#0574C5'>"+d.properties.europe_PAYS+"</span>":"";return texte}).on("mouseover",over).on("mouseout",out).on("click",click)});function over(d){if(d.properties.europe_UE=="O"&&
d.properties.url!=pays_page){var pays=d3.select(this);pays.transition().duration(600).attr("fill","#FCAA06")}}function out(d){if(d.properties.europe_UE=="O"&&d.properties.url!=pays_page){var pays=d3.select(this);pays.transition().duration(300).attr("fill","#c7dfea")}}function click(d){if(d.properties.url!=pays_page)console.log(d.properties.url)}function overMalte(d){var pays=d3.select(this);pays.transition().duration(600).attr("fill-opacity",1).attr("fill","#FCAA06")}function outMalte(d){var pays=
d3.select(this);pays.transition().duration(600).attr("fill-opacity",0).attr("fill","#c7dfea")}function clickMalte(d){if(d.properties.url!=pays_page)console.log(d.properties.url)}}return{"init":init}});
